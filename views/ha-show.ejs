<%- include("./partials/header") %>

<br>

<!-- ============================================================================================= -->
<!-- Button for Add DD -->
<!-- ============================================================================================= -->
<button class="btn btn-primary" data-toggle="modal" data-target="#he-modal">
  Add HA DD's
</button>

<!-- Add DD Modal -->
<div class="modal fade" id="he-modal">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Upload HE DD</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <form action="/ha-upload" method="POST">
        <div class="modal-body">
          <textarea id="excel_data" name="excel_data" style="width:250px;height:150px;"></textarea>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button class="btn btn-primary">Upload</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ============================================================================================= -->
<!-- Display DD Table -->
<!-- ============================================================================================= -->
<div class="table-responsive">
  <table id="excel_table" class="table table-hover table-striped table-bordered table-sm">
    <thead class="thead-dark">
      <tr>
        <th scope="col">Truck</th>
        <th scope="col">Model</th>
        <th scope="col">Units</th>
        <th scope="col">CBM</th>
        <th scope="col">City</th>
        <th scope="col">Customer</th>
        <th scope="col">W/H</th>
        <th scope="col">Slot Date</th>
        <th scope="col">Slot Time</th>
        <th scope="col">Reservation No</th>
        <th scope="col">Status</th>
        <th scope="col">Line Status</th>
        <th scope="col">Order No</th>
        <th scope="col">Line No</th>
        <th scope="col">Ship To</th>
        <th scope="col">Select</th>
        <th scope="col">Detail</th>
        <th scope="col">
          <form action="/ha-dd?_method=DELETE" method="POST">
            <div class="text-center">
              <button class="btn btn-danger btn-sm">Delete All</button>
            </div>
          </form>
        </th>
      </tr>
    </thead>
    <tbody>
      <% data.forEach((detail) => { %>
      <tr>
        <form class="truck-update" action="/ha-dd/<%= detail._id %>/truck?_method=PUT" method="POST">
          <td>
            <% if (detail.Truck === "") { %>
            <input type="text" name="truck">
            <% } else { %>
            <%= detail.Truck %>
            <% } %>
          </td>
        </form>
        <td><%= detail.Model %></td>
        <td><%= detail["Order Qty"] %></td>
        <td><%= detail["Item CBM"] %></td>
        <td><%= detail["Receiver City Desc"] %></td>
        <td><%= detail["Bill To Name"] %></td>
        <td><%= detail["Inventory Org"] %></td>
        <td><%= detail["Slot Date"] %></td>
        <td><%= detail["Slot Time"] %></td>
        <td><%= detail["Reservation No"] %></td>
        <td><%= detail["Status"] %></td>
        <td><%= detail["Sub- Inventory"] %></td>
        <td><%= detail["Order No"] %></td>
        <td><%= detail["Line No"] %></td>
        <td><%= detail["Ship To Name"] %></td>
        <td>
          <form class="mark" action="/ha-dd/<%= detail._id %>?_method=PUT" method="POST">
            <input class="checkbox" type="checkbox" name="checkbox" <%= detail.marked ? "checked" : ""  %>>
          </form>
        </td>
        <td>
          <form action="/ha-dd/<%= detail._id %>?_method=DELETE" method="POST">
            <div class="text-center">
              <button class="btn btn-outline-info btn-sm">Info</button>
            </div>
          </form>
        </td>
        <td>
          <form action="/ha-dd/<%= detail._id %>?_method=DELETE" method="POST">
            <div class="text-center">
              <button class="btn btn-outline-danger btn-sm">X</button>
            </div>
          </form>
        </td>
      </tr>
      <% }) %>
    </tbody>
  </table>
</div>

<!-- ============================================================================================= -->
<!-- JS & Event Listeners -->
<!-- ============================================================================================= -->
<script type="text/javascript">
  let markForm = document.getElementsByClassName("mark");
  let checkbox = document.getElementsByClassName("checkbox");

  let truckForm = document.getElementsByClassName("truck-update");

  for (let i = 0; i < markForm.length; i++) {
    markForm[i].addEventListener("change", function () {
      markForm[i].submit();
    })
  }

  for (let i = 0; i < truckForm.length; i++) {
    truckForm[i].addEventListener("keyup", function (e) {
      if (e.keyCode === 9) {
        truckForm[i].submit()
      }
    })
  }
</script>

<%- include("./partials/footer") %>